# Руководство по настройке R-Keeper интеграции

## Обзор

Этот документ содержит пошаговые инструкции по настройке интеграции с R-Keeper для вашего приложения кофейни.

## Требования

### 1. R-Keeper Server
- **R-Keeper Server** - установленный и настроенный сервер
- **API доступ** - включенный API модуль
- **Административные права** - доступ к настройкам системы

### 2. Сетевое подключение
- **Стабильный интернет** - для связи с сервером R-Keeper
- **Открытые порты** - обычно 8080 для API
- **Firewall настройки** - разрешить подключения

### 3. Учетные данные
- **Логин администратора** - для доступа к API
- **Пароль администратора** - для аутентификации
- **ID ресторана** - идентификатор вашего ресторана

## Настройка

### Шаг 1: Настройка R-Keeper Server

1. **Убедитесь, что R-Keeper Server запущен**
2. **Включите API модуль** в настройках сервера
3. **Настройте доступ** для внешних приложений
4. **Проверьте порт** API (обычно 8080)

### Шаг 2: Получение учетных данных

1. **Войдите в R-Keeper** как администратор
2. **Перейдите в настройки** → API
3. **Создайте API ключ** для вашего приложения
4. **Запомните ID ресторана** из настроек

### Шаг 3: Конфигурация приложения

Откройте файл `rkeeper-config.js` и заполните следующие поля:

```javascript
const RKEEPER_CONFIG = {
    // Настройки сервера
    rkeeper: {
        serverUrl: 'http://YOUR_RKEEPER_SERVER:8080',
        apiVersion: 'v1',
        timeout: 30000
    },
    
    // Аутентификация
    authentication: {
        username: 'YOUR_RKEEPER_USERNAME',
        password: 'YOUR_RKEEPER_PASSWORD'
    },
    
    // Настройки ресторана
    restaurant: {
        id: 'YOUR_RESTAURANT_ID',
        name: 'Art Coffee',
        address: 'Nicosia, Cyprus'
    }
};
```

### Шаг 4: Тестирование подключения

1. **Откройте** `test-rkeeper.html` в браузере
2. **Заполните** все поля конфигурации
3. **Нажмите** "Обновить конфигурацию"
4. **Проверьте** подключение к серверу
5. **Протестируйте** аутентификацию

## Основные функции

### Создание заказов

```javascript
// Создать заказ в R-Keeper
const orderData = {
    items: [
        { id: 1, name: 'Эспрессо', price: 120, quantity: 1, category: 'coffee' }
    ],
    total: 120,
    customerInfo: {
        name: 'Иван Иванов',
        phone: '+357 99 123456',
        email: 'ivan@example.com'
    },
    paymentMethod: 'CARD'
};

const result = await rkeeperSystem.createOrder(orderData);
```

### Синхронизация меню

```javascript
// Синхронизировать меню с R-Keeper
const result = await rkeeperSystem.syncMenu();
if (result.success) {
    console.log(`Синхронизировано товаров: ${result.syncedItems}`);
}
```

### Обновление статуса заказа

```javascript
// Обновить статус заказа
const result = await rkeeperSystem.updateOrderStatus(orderId, 'PREPARING');
if (result.success) {
    console.log('Статус заказа обновлен');
}
```

### Получение отчетов

```javascript
// Получить статистику
const stats = await rkeeperSystem.getStatistics('today');

// Получить отчет
const report = await rkeeperSystem.getReport('daily', '2024-01-01', '2024-01-31');
```

## Настройки интеграции

### Автоматическая синхронизация

```javascript
// Включить автоматическую синхронизацию меню
menu: {
    syncEnabled: true,
    syncInterval: 30, // каждые 30 минут
    autoUpdatePrices: true
}
```

### Уведомления

```javascript
// Настроить уведомления
notifications: {
    enabled: true,
    types: {
        orderCreated: true,
        orderUpdated: true,
        orderCompleted: true
    }
}
```

### Безопасность

```javascript
// Настройки безопасности
security: {
    encryptData: true,
    forceHttps: true,
    sessionTimeout: 480, // 8 часов
    allowedIPs: ['192.168.1.100', '10.0.0.50']
}
```

## Устранение неполадок

### Частые проблемы

1. **Ошибка подключения к серверу**
   - Проверьте URL сервера
   - Убедитесь, что сервер запущен
   - Проверьте сетевые настройки

2. **Ошибка аутентификации**
   - Проверьте логин и пароль
   - Убедитесь в правильности ID ресторана
   - Проверьте права доступа

3. **Ошибка создания заказа**
   - Проверьте формат данных заказа
   - Убедитесь, что все обязательные поля заполнены
   - Проверьте статус подключения

### Логи для отладки

```javascript
// Включите подробное логирование
integration: {
    logging: {
        enabled: true,
        level: 'DEBUG'
    }
}
```

## Мониторинг

### Проверка статуса

```javascript
// Проверить статус подключения
const status = await rkeeperSystem.checkConnection();
console.log('Статус:', status);
```

### Логирование

Система автоматически ведет логи:
- Подключений к серверу
- Созданных заказов
- Ошибок интеграции
- Синхронизации меню

## Производительность

### Оптимизация запросов

1. **Кэширование** - кэшируйте меню и настройки
2. **Батчинг** - группируйте запросы
3. **Таймауты** - настройте разумные таймауты
4. **Повторы** - настройте автоматические повторы

### Мониторинг производительности

```javascript
// Настройка мониторинга
integration: {
    monitoring: {
        enabled: true,
        metrics: {
            responseTime: true,
            errorRate: true,
            throughput: true
        }
    }
}
```

## Безопасность

### Рекомендации

1. **Используйте HTTPS** для всех запросов
2. **Ограничьте IP адреса** в настройках безопасности
3. **Регулярно обновляйте** пароли
4. **Ведите логи** всех операций
5. **Шифруйте** чувствительные данные

### Настройка переменных окружения

```bash
# Создайте файл .env
RKEEPER_SERVER_URL=http://your-server:8080
RKEEPER_USERNAME=your_username
RKEEPER_PASSWORD=your_password
RKEEPER_RESTAURANT_ID=your_restaurant_id
```

## Поддержка

### Контакты
- **Техническая поддержка R-Keeper**: support@rkeeper.ru
- **Документация API**: https://docs.rkeeper.ru
- **Форум**: https://forum.rkeeper.ru

### Полезные ссылки
- [R-Keeper Official](https://www.rkeeper.ru)
- [API Documentation](https://api.rkeeper.ru/docs)
- [Integration Guide](https://docs.rkeeper.ru/integration)

## Обновления

Система поддерживает автоматические обновления:
- API версии
- Конфигурации
- Безопасности
- Производительности

---

**Важно**: Всегда тестируйте изменения в тестовом режиме перед переходом в продакшен!

## Дополнительные настройки

### Настройка сети

1. **Статический IP** для сервера R-Keeper
2. **Порт 8080** для API
3. **Firewall** - разрешить подключения
4. **VPN** для удаленного доступа

### Резервное копирование

1. **Конфигурация** - сохраните настройки
2. **Логи** - регулярно архивируйте
3. **База данных** - создавайте бэкапы
4. **API ключи** - храните в безопасном месте

### Мониторинг

1. **Статус сервера** - проверяйте регулярно
2. **Соединение** - мониторьте стабильность
3. **Ошибки** - настройте уведомления
4. **Производительность** - отслеживайте метрики
